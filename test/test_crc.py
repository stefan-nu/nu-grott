import unittest
import crc
import libscrc


# Unit Tests for modul grottproxy.py



class TestCRC(unittest.TestCase):
    
    def test_Local_crc_vs_libscrc_implementation(self):
        test1 = b'\x00\x00\x00\x00'
        test2 = b'\xff\xff\xff\xff'
        test3 = b'\xAA\xAA\xAA\xAA'
        test4 = b'\x55\x55\x55\x55'
        test5 = b'\xDE\xAD\xBE\xEF'

        tests = [test1, test2, test3, test4, test5]

        for t in tests:
            crc_calc_lib = libscrc.modbus(t)
            crc_calc_py  = crc.modbus_crc_python(t)
            self.assertEqual(crc_calc_lib, crc_calc_py)
        

    def test_calc_crc_with_zero_data(self):
        testvalue = b''
        self.assertEqual(crc.modbus_crc(testvalue), 65535)
        

    def test_calc_crc_with_some_4byte_values(self):
        test_value = bytearray(b'\xa2\x00\x00\x00\x00')
        self.assertEqual(crc.modbus_crc(test_value), 55773)

        test_value = bytearray(b'\xa2\x01\x02\x03\x04')
        self.assertEqual(crc.modbus_crc(test_value), 54908)

        test_value = bytearray(b'\xa2\xFF\xFF\xFF\x0FF')
        self.assertEqual(crc.modbus_crc(test_value), 27529)
        
        
    def test_calc_crc_with_longer_value(self):
        test_value = b'\x00\x0f\x00\x06\x01\x41\x01\x38\x1f\x35\x2b\x41\x22\x32\x40 \
        \x75\x25\x59\x77\x61\x74\x74\x47\x72\x6f\x77\x61\x74\x74\x47\x72\x6f\x77\x61 \
        \x74\x74\x47\x72\x24\x39\x2f\x44\x30\x70\x46\x5f\x44\x23\x74\x74\x47\x72\x6f \
        \x77\x61\x74\x74\x47\x72\x72\x6f\x77\x61\x74\x74\x47\x72\x6f\x77\x78\x70\x65 \
        \x56\x48\x71\x74\x72\xac\x67\xb8\x72\x6c\x14\x05\x74\x10\x45\x65\x90\x88\x9e \
        \x8f\x74\x47\x73\x01\x7a\x72\x79\x78\x46\x58\x6e\x63\x61\x74\x76\x61\x72\x6e \
        \x74\x81\x55\x17\x47\x72\x6d\xc8\x61\x76\x74\x47\x73\xfd\x77\x61\x74\x74\x47 \
        \x73\x2f\x27\x62\x9c\x67\xc9\x72\x67\x77\x64\x74\x7f\x47\x72\x6f\x77\x61\x74 \
        \x74\x47\x72\x6f\x77\x61\x74\x74\x47\x72\x6f\x77\x75\x74\x60\x60\x72\x6c\x14 \
        \x05\x74\x10\x45\x64\x6f\x77\x61\x74\x74\x47\x73\x0e\x7a\x70\x79\x7f\x46\x53 \
        \x6e\x71\x61\x74\x76\x61\x72\x6e\x74\x80\x56\x17\x47\x72\x6d\xc8\x61\x76\x74 \
        \x47\x73\xe5\x77\x61\x74\x74\x47\x73\x53\x1f\x62\x9c\x67\xcb\x72\x67\x77\x64 \
        \x74\x7f\x47\x72\x6f\x77\x61\x74\x74\x47\x72\x6f\x77\x61\x74\x74\x47\x72\x6f \
        \x77\x75\x5c\x60\x08\x72\x6c\x14\x05\x74\x10\x45\x64\x90\x88\x9e\x8f\x74\x47 \
        \x73\x07\x7a\x71\x79\x7f\x46\x7c\x6f\x81\x61\x74\x76\x61\x72\x6e\x74\xbf\x57 \
        \x17\x47\x72\x6d\xc8\x61\x76\x74\x47\x73\xff\x77\x61\x74\x74\x47\x73\x2f\x27 \
        \x62\x9c\x67\xc8\x72\x67\x77\x64\x74\x7f\x47\x72\x6f\x77\x61\x74\x74\x47\x72 \
        \x6f\x77\x61\x74\x74\x47\x72\x6f\x77\xc9\xc4'
        self.assertEqual(crc.modbus_crc(test_value), 10721)
        

if __name__ == '__main__':
    unittest.main()